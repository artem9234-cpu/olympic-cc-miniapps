<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé° –†—É–ª–µ—Ç–∫–∞ –ª—É—á—à–∏—Ö</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --primary: #8a2be2; /* —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
      --secondary: #f5f5dc; /* –±–µ–∂–µ–≤—ã–π */
      --accent: #87ceeb; /* –≥–æ–ª—É–±–æ–π */
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: white;
      min-height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    .container {
      position: relative;
      width: 100%;
      max-width: 500px;
      padding: 20px;
    }
    .stars {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle var(--dur, 3s) infinite ease-in-out;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }
    .header {
      margin-bottom: 20px;
      z-index: 2;
      position: relative;
    }
    h1 {
      font-size: 2.2em;
      margin: 10px 0;
      background: linear-gradient(to right, var(--primary), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .subtitle {
      font-size: 1.1em;
      opacity: 0.8;
    }
    .wheel-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto 30px;
      z-index: 2;
    }
    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(
        #ff9a9e 0deg, #fad0c4 30deg,
        #a1c4fd 30deg, #c2e9fb 60deg,
        #cfd9df 60deg, #e6ee9c 90deg,
        #ffecd2 90deg, #fcb69f 120deg,
        #ff9a9e 120deg, #fad0c4 150deg,
        #a1c4fd 150deg, #c2e9fb 180deg,
        #cfd9df 180deg, #e6ee9c 210deg,
        #ffecd2 210deg, #fcb69f 240deg,
        #ff9a9e 240deg, #fad0c4 270deg,
        #a1c4fd 270deg, #c2e9fb 300deg,
        #cfd9df 300deg, #e6ee9c 330deg,
        #ffecd2 330deg, #fcb69f 360deg
      );
      box-shadow: 0 0 30px rgba(138, 43, 226, 0.5);
      transition: transform 5s cubic-bezier(0.23, 1, 0.32, 1);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-weight: bold;
      font-size: 1.5em;
    }
    .center {
      width: 60px;
      height: 60px;
      background: #ffd700;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
    }
    .center::after {
      content: 'üéØ';
      font-size: 24px;
    }
    .button {
      background: linear-gradient(to right, var(--primary), #6a0dad);
      color: white;
      border: none;
      padding: 14px 32px;
      font-size: 1.2em;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 6px 15px rgba(138, 43, 226, 0.4);
      z-index: 2;
      position: relative;
    }
    .button:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(138, 43, 226, 0.6);
    }
    .button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .result {
      margin-top: 30px;
      background: rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      display: none;
    }
    .result-title {
      font-size: 1.4em;
      margin-bottom: 15px;
      color: var(--accent);
    }
    .employee {
      background: rgba(138, 43, 226, 0.15);
      margin: 10px 0;
      padding: 12px;
      border-radius: 10px;
      text-align: left;
    }
    .employee-name {
      font-weight: bold;
      font-size: 1.1em;
    }
    .medal { font-size: 1.3em; margin-right: 6px; }
  </style>
</head>
<body>
  <div class="stars" id="stars"></div>
  <div class="container">
    <div class="header">
      <h1>üé° –†—É–ª–µ—Ç–∫–∞ –ª—É—á—à–∏—Ö</h1>
      <div class="subtitle">–ö–æ–ª–ª-—Ü–µ–Ω—Ç—Ä ¬´–û–ª–∏–º–ø–∏–π—Å–∫–∏–π¬ª</div>
    </div>

    <div class="wheel-container">
      <div class="wheel" id="wheel">–ö—Ä—É—Ç–∏–º...</div>
      <div class="center"></div>
    </div>

    <button class="button" id="spinBtn">üéØ –ö—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É!</button>

    <div class="result" id="result">
      <div class="result-title">üéä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</div>
      <div id="employeesList"></div>
    </div>
  </div>

  <script>
    // === –ì–ï–ù–ï–†–ê–¶–ò–Ø –ó–í–Å–ó–î ===
    const starsContainer = document.getElementById('stars');
    for (let i = 0; i < 50; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.width = star.style.height = Math.random() * 3 + 'px';
      star.style.setProperty('--dur', (2 + Math.random() * 4) + 's');
      starsContainer.appendChild(star);
    }

    // === –ê–£–î–ò–û (FALLBACK ‚Äî BASE64) ===
    const spinSound = new Audio();
    const winSound = new Audio();
    
    // –ö–æ—Ä–æ—Ç–∫–∏–π "–≤–∂–∂–∂–∂" (base64, ~1 —Å–µ–∫)
    spinSound.src = "data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGlua3MgLSBGcmVlIFNvdW5kIEVmZmVjdHMAAAAAAAAAAAAAAAAAAAAA//uQxAADwAABp3ZhQVBBU0NJSUkqUElDVAAPAAABTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//uQwAMDA1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV......"; // —É–∫–æ—Ä–æ—á–µ–Ω–æ –¥–ª—è —á–∞—Ç–∞; –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ ‚Äî –ø–æ–ª–Ω—ã–π base64

    // –ü–æ–±–µ–¥–Ω—ã–π "ding!" (base64)
    winSound.src = "data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGlua3MgLSBGcmVlIFNvdW5kIEVmZmVjdHMAAAAAAAAAAAAAAAAAAAAA//uQxAADwAABp3ZhQVBBU0NJSUkqUElDVAAPAAABTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//uQwAMDA1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV......";

    // === –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
    const wheel = document.getElementById('wheel');
    const spinBtn = document.getElementById('spinBtn');
    const resultDiv = document.getElementById('result');
    const employeesList = document.getElementById('employeesList');

    // üîπ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô GAS_URL ‚Äî –ë–ï–ó –ü–†–û–ë–ï–õ–û–í
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyQBgFVhhNhmhWGeLZB55tbpbxnJW5ah44DlhS_XRFTlBhzIORhJt_1bfen1OW1x51_WA/exec";

    // === –§–£–ù–ö–¶–ò–Ø –ö–†–£–ß–ï–ù–ò–Ø ===
    async function spin() {
      spinBtn.disabled = true;
      spinBtn.textContent = 'üé° –ö—Ä—É—Ç–∏–º...';
      wheel.textContent = '–ö—Ä—É—Ç–∏–º...';
      resultDiv.style.display = 'none';

      // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
      const rotations = 5 + Math.random() * 5;
      const baseDeg = 360 * rotations;
      const finalDeg = baseDeg + Math.random() * 360;
      wheel.style.transform = `rotate(${finalDeg}deg)`;

      // –ó–≤—É–∫ –≤—Ä–∞—â–µ–Ω–∏—è
      try { spinSound.play().catch(e => console.log('üîá spin sound muted')); } catch {}

      // –ó–∞–ø—Ä–æ—Å –∫ GAS
      try {
        const response = await fetch(`${GAS_URL}?action=spin&t=${Date.now()}`);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const data = await response.json();

        if (!data.success) throw new Error(data.error || 'API error');

        // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ (~5 —Å–µ–∫)
        await new Promise(r => setTimeout(r, 5000));

        // –ó–≤—É–∫ –ø–æ–±–µ–¥—ã
        try { winSound.play().catch(e => console.log('üîá win sound muted')); } catch {}

        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        displayResults(data.data);
      } catch (err) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', err);
        wheel.textContent = '–û—à–∏–±–∫–∞';
        spinBtn.textContent = 'üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å';
        alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:\n${err.message}`);
      } finally {
        spinBtn.disabled = false;
      }
    }

    function displayResults(employees) {
      employeesList.innerHTML = '';
      const medals = ['ü•á', 'ü•à', 'ü•â', 'üéñÔ∏è', 'üèÖ'];

      employees.forEach((emp, i) => {
        const div = document.createElement('div');
        div.className = 'employee';
        div.innerHTML = `
          <div class="employee-name"><span class="medal">${medals[i] || 'üë§'}</span>${emp.name || '‚Äî'}</div>
          üìû –ó–≤–æ–Ω–∫–∏: ${emp.calls || '‚Äì'}<br>
          ‚è± AHT: ${emp.aht || '‚Äì'}<br>
          ‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ: ${emp.missed || '‚Äì'}<br>
          ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ: ${emp.quality || '‚Äì'}
        `;
        employeesList.appendChild(div);
      });

      resultDiv.style.display = 'block';
      wheel.textContent = '–ì–æ—Ç–æ–≤–æ!';
    }

    spinBtn.addEventListener('click', spin);

    // Telegram WebApp.ready()
    if (window.Telegram && Telegram.WebApp) {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
    }
  </script>
</body>
</html>
