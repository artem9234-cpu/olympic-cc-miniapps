<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>üé° –†—É–ª–µ—Ç–∫–∞ –ª—É—á—à–∏—Ö</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --primary: #8a2be2;
      --accent: #87ceeb;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
      color: white;
      min-height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 16px;
    }
    .header {
      text-align: center;
      margin: 10px 0 16px;
      width: 100%;
    }
    h1 {
      font-size: 1.8em;
      margin: 6px 0;
      background: linear-gradient(to right, var(--primary), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 800;
    }
    .subtitle {
      font-size: 0.95em;
      opacity: 0.85;
      margin-top: 4px;
    }
    .wheel-container {
      position: relative;
      width: 100%;
      max-width: 280px;
      aspect-ratio: 1 / 1;
      margin: 0 auto 20px;
    }
    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(
        #ff9a9e 0deg, #fad0c4 30deg,
        #a1c4fd 30deg, #c2e9fb 60deg,
        #cfd9df 60deg, #e6ee9c 90deg,
        #ffecd2 90deg, #fcb69f 120deg,
        #ff9a9e 120deg, #fad0c4 150deg,
        #a1c4fd 150deg, #c2e9fb 180deg,
        #cfd9df 180deg, #e6ee9c 210deg,
        #ffecd2 210deg, #fcb69f 240deg,
        #ff9a9e 240deg, #fad0c4 270deg,
        #a1c4fd 270deg, #c2e9fb 300deg,
        #cfd9df 300deg, #e6ee9c 330deg,
        #ffecd2 330deg, #fcb69f 360deg
      );
      box-shadow: 0 0 20px rgba(138, 43, 226, 0.6);
      transition: transform 5s cubic-bezier(0.23, 1, 0.32, 1);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-weight: bold;
      font-size: 1.3em;
      user-select: none;
    }
    .button {
      background: linear-gradient(to right, var(--primary), #5d0ca8);
      color: white;
      border: none;
      padding: 13px 0;
      font-size: 1.15em;
      font-weight: 600;
      border-radius: 50px;
      cursor: pointer;
      width: 90%;
      max-width: 300px;
      box-shadow: 0 4px 12px rgba(138, 43, 226, 0.4);
      margin: 20px 0;
    }
    .button:active {
      transform: scale(0.98);
    }
    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .result {
      width: 100%;
      max-width: 400px;
      background: rgba(255,255,255,0.07);
      border-radius: 14px;
      padding: 16px;
      margin-top: 10px;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.1);
      display: none;
      max-height: 280px;
      overflow-y: auto;
    }
    .result-title {
      font-size: 1.25em;
      margin-bottom: 12px;
      color: var(--accent);
      text-align: center;
    }
    .employee {
      background: rgba(138, 43, 226, 0.12);
      padding: 11px;
      margin: 8px 0;
      border-radius: 10px;
      text-align: left;
    }
    .employee-name {
      font-weight: 600;
      font-size: 1.05em;
    }
    .medal { font-size: 1.25em; margin-right: 5px; }
    .status {
      font-size: 0.9em;
      opacity: 0.8;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üé° –†—É–ª–µ—Ç–∫–∞ –ª—É—á—à–∏—Ö</h1>
    <div class="subtitle">–ö–æ–ª–ª-—Ü–µ–Ω—Ç—Ä ¬´–û–ª–∏–º–ø–∏–π—Å–∫–∏–π¬ª</div>
  </div>

  <div class="wheel-container">
    <div class="wheel" id="wheel">–ì–æ—Ç–æ–≤–æ!</div>
  </div>

  <button class="button" id="spinBtn">üéØ –ö—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É</button>

  <div class="result" id="result">
    <div class="result-title">üéä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</div>
    <div id="employeesList"></div>
  </div>

  <script>
    // === BASE64 –ó–í–£–ö–ò (–±–µ–∑ —Ñ–∞–π–ª–æ–≤) ===
    const spinSound = new Audio("data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGlua3MgLSBGcmVlIFNvdW5kIEVmZmVjdHMAAAAAAAAAAAAAAAAAAAAA//uQxAADwAABp3ZhQVBBVVMgTElDZW5zZSBodHRwOi8vbGljZW5zZS5iaWdzb3VuZGJhbmsuY29tL3B1YmxpYy9zdGFuZGFyZC1saWNlbnNlLmh0bWwAAAAAAAAAAAAAAAAA");
    const winSound = new Audio("data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGlua3MgLSBGcmVlIFNvdW5kIEVmZmVjdHMAAAAAAAAAAAAAAAAAAAAA//uQxAADwAABp3ZhQVBBVVMgTElDZW5zZSBodHRwOi8vbGljZW5zZS5iaWdzb3VuZGJhbmsuY29tL3B1YmxpYy9zdGFuZGFyZC1saWNlbnNlLmh0bWwAAAAAAAAAAAAAAAAA");

    // === URL (–ë–ï–ó –ü–†–û–ë–ï–õ–û–í!) ===
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxoCRyJ6k2y-fphW2D2jjVi8GldHXmDrdvoYwxVFUnnR6QLyg-67NxP-TPrfK0QksipAw/exec";

    const wheel = document.getElementById('wheel');
    const spinBtn = document.getElementById('spinBtn');
    const resultDiv = document.getElementById('result');
    const employeesList = document.getElementById('employeesList');

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM WEB APP ===
    if (window.Telegram?.WebApp) {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
      Telegram.WebApp.setHeaderColor('#1a1a2e');
      Telegram.WebApp.setBackgroundColor('#0f3460');
    }

    // === –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ===
    async function spin() {
      spinBtn.disabled = true;
      spinBtn.textContent = 'üé° –ö—Ä—É—Ç–∏–º...';
      wheel.textContent = '–ö—Ä—É—Ç–∏–º...';
      resultDiv.style.display = 'none';

      // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
      const rotations = 5 + Math.random() * 3;
      const finalDeg = 360 * rotations + Math.floor(Math.random() * 360);
      wheel.style.transform = `rotate(${finalDeg}deg)`;

      // –ó–≤—É–∫ –≤—Ä–∞—â–µ–Ω–∏—è
      try { spinSound.play(); } catch {}

      let data = null;

      try {
        // 1Ô∏è‚É£ –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ GAS (–æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å)
        const response = await fetch(`${GAS_URL}?action=spin&t=${Date.now()}`, {
          method: 'GET',
          headers: { 'User-Agent': 'Mozilla/5.0' }
        });

        // –ï—Å–ª–∏ –ø—Ä–∏—à—ë–ª HTML (¬´NTA –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞¬ª) ‚Äî –ø—Ä–æ–±—É–µ–º fallback
        const text = await response.text();
        if (text.includes('Nepal Telecommunication Authority') || text.includes('<html')) {
          throw new Error('Blocked by NTA');
        }

        data = JSON.parse(text);
        if (!data.success) throw new Error(data.error || 'API error');

      } catch (err) {
        console.warn('‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —É–ø–∞–ª:', err.message);

        // 2Ô∏è‚É£ FALLBACK: –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ GitHub Pages (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)
        try {
          const fallbackResponse = await fetch('https://artem9234-cpu.github.io/olympic-cc-miniapps/fallback.json?t=' + Date.now());
          if (fallbackResponse.ok) {
            data = await fallbackResponse.json();
          } else {
            throw new Error('Fallback –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
          }
        } catch (fallbackErr) {
          // 3Ô∏è‚É£ –ö—Ä–∞–π–Ω–∏–π fallback: –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É
          alert('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ Telegram Desktop.');
          spinBtn.disabled = false;
          spinBtn.textContent = 'üéØ –ö—Ä—É—Ç–∏—Ç—å —Å–Ω–æ–≤–∞';
          return;
        }
      }

      // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
      await new Promise(r => setTimeout(r, 5000));

      // –ó–≤—É–∫ –ø–æ–±–µ–¥—ã
      try { winSound.play(); } catch {}

      // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      displayResults(data.data || []);
      spinBtn.disabled = false;
      spinBtn.textContent = 'üéØ –ö—Ä—É—Ç–∏—Ç—å —Å–Ω–æ–≤–∞';
    }

    function displayResults(employees) {
      employeesList.innerHTML = '';
      const medals = ['ü•á', 'ü•à', 'ü•â', 'üéñÔ∏è', 'üèÖ'];

      employees.slice(0, 5).forEach((emp, i) => {
        const div = document.createElement('div');
        div.className = 'employee';
        const nameLine = `<span class="medal">${medals[i] || 'üë§'}</span>${emp.name || '‚Äî'}`;
        div.innerHTML = `
          <div class="employee-name">${nameLine}</div>
          üìû –ó–≤–æ–Ω–∫–∏: ${emp.calls || '‚Äì'}<br>
          ‚è± AHT: ${emp.aht || '‚Äì'}<br>
          ‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ: ${emp.missed || '‚Äì'}<br>
          ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ: ${emp.quality || '‚Äì'}
        `;
        employeesList.appendChild(div);
      });

      resultDiv.style.display = 'block';
      wheel.textContent = '–ì–æ—Ç–æ–≤–æ!';
    }

    spinBtn.addEventListener('click', spin);

    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã
    function adjustLayout() {
      const h1 = document.querySelector('h1');
      if (window.innerWidth < 360) {
        h1.style.fontSize = '1.5em';
      } else {
        h1.style.fontSize = '1.8em';
      }
    }
    window.addEventListener('resize', adjustLayout);
    adjustLayout();
  </script>
</body>
</html>
