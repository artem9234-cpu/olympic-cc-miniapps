<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé° –†—É–ª–µ—Ç–∫–∞ –ª—É—á—à–∏—Ö</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --primary: #8a2be2; /* —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
      --secondary: #f5f5dc; /* –±–µ–∂–µ–≤—ã–π */
      --accent: #87ceeb; /* –≥–æ–ª—É–±–æ–π */
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: white;
      min-height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    .container {
      position: relative;
      width: 100%;
      max-width: 500px;
      padding: 20px;
      z-index: 2;
    }
    .header {
      margin-bottom: 20px;
    }
    h1 {
      font-size: 2.2em;
      margin: 10px 0;
      background: linear-gradient(to right, var(--primary), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .subtitle {
      font-size: 1.1em;
      opacity: 0.8;
    }
    .wheel-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto 30px;
    }
    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(
        #ff9a9e 0deg, #fad0c4 30deg,
        #a1c4fd 30deg, #c2e9fb 60deg,
        #cfd9df 60deg, #e6ee9c 90deg,
        #ffecd2 90deg, #fcb69f 120deg,
        #ff9a9e 120deg, #fad0c4 150deg,
        #a1c4fd 150deg, #c2e9fb 180deg,
        #cfd9df 180deg, #e6ee9c 210deg,
        #ffecd2 210deg, #fcb69f 240deg,
        #ff9a9e 240deg, #fad0c4 270deg,
        #a1c4fd 270deg, #c2e9fb 300deg,
        #cfd9df 300deg, #e6ee9c 330deg,
        #ffecd2 330deg, #fcb69f 360deg
      );
      box-shadow: 0 0 30px rgba(138, 43, 226, 0.5);
      transition: transform 5s cubic-bezier(0.23, 1, 0.32, 1);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-weight: bold;
      font-size: 1.5em;
    }
    .center {
      width: 60px;
      height: 60px;
      background: #ffd700;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
    }
    .center::after {
      content: 'üéØ';
      font-size: 24px;
    }
    .button {
      background: linear-gradient(to right, var(--primary), #6a0dad);
      color: white;
      border: none;
      padding: 14px 32px;
      font-size: 1.2em;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 6px 15px rgba(138, 43, 226, 0.4);
      z-index: 2;
      position: relative;
    }
    .button:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(138, 43, 226, 0.6);
    }
    .button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .result {
      margin-top: 30px;
      background: rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      display: none;
      max-height: 300px;
      overflow-y: auto;
    }
    .result-title {
      font-size: 1.4em;
      margin-bottom: 15px;
      color: var(--accent);
    }
    .employee {
      background: rgba(138, 43, 226, 0.15);
      margin: 10px 0;
      padding: 12px;
      border-radius: 10px;
      text-align: left;
    }
    .employee-name {
      font-weight: bold;
      font-size: 1.1em;
    }
    .medal { font-size: 1.3em; margin-right: 6px; }
    .fallback-badge {
      background: #d32f2f;
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      margin-left: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üé° –†—É–ª–µ—Ç–∫–∞ –ª—É—á—à–∏—Ö</h1>
      <div class="subtitle">–ö–æ–ª–ª-—Ü–µ–Ω—Ç—Ä ¬´–û–ª–∏–º–ø–∏–π—Å–∫–∏–π¬ª</div>
    </div>

    <div class="wheel-container">
      <div class="wheel" id="wheel">–ì–æ—Ç–æ–≤–æ!</div>
      <div class="center"></div>
    </div>

    <button class="button" id="spinBtn">üéØ –ö—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É!</button>

    <div class="result" id="result">
      <div class="result-title">üéä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</div>
      <div id="employeesList"></div>
    </div>
  </div>

  <script>
    // === FALLBACK –î–ê–ù–ù–´–ï (–¥–µ–º–æ-—Ä–µ–∂–∏–º) ===
    const DEMO_DATA = [
      {name: "–ò–≤–∞–Ω–æ–≤", calls: 420, aht: "3:12", missed: 2, quality: "98%"},
      {name: "–ü–µ—Ç—Ä–æ–≤–∞", calls: 395, aht: "3:45", missed: 1, quality: "100%"},
      {name: "–°–∏–¥–æ—Ä–æ–≤", calls: 380, aht: "4:01", missed: 3, quality: "96%"},
      {name: "–ö–æ–∑–ª–æ–≤–∞", calls: 372, aht: "3:55", missed: 0, quality: "99%"},
      {name: "–ú–æ—Ä–æ–∑–æ–≤", calls: 368, aht: "4:10", missed: 4, quality: "94%"}
    ];

    // === –ê–£–î–ò–û (BASE64 ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–µ —Ñ–æ–ª–±—ç–∫–∏) ===
    const spinSound = new Audio("data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGlua3MgLSBGcmVlIFNvdW5kIEVmZmVjdHMAAAAAAAAAAAAAAAAAAAAA//uQxAADwAABp3ZhQVBBVVMgTElDZW5zZSBodHRwOi8vbGljZW5zZS5iaWdzb3VuZGJhbmsuY29tL3B1YmxpYy9zdGFuZGFyZC1saWNlbnNlLnBocD9pZD0xMDYyMzEAAAAAAAAAAAAAAAAAAA==");
    const winSound = new Audio("data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGlua3MgLSBGcmVlIFNvdW5kIEVmZmVjdHMAAAAAAAAAAAAAAAAAAAAA//uQxAADwAABp3ZhQVBBVVMgTElDZW5zZSBodHRwOi8vbGljZW5zZS5iaWdzb3VuZGJhbmsuY29tL3B1YmxpYy9zdGFuZGFyZC1saWNlbnNlLnBocD9pZD0xMTY3MzUAAAAAAAAAAAAAAAAAAA==");

    // === URL (–ë–ï–ó –ü–†–û–ë–ï–õ–û–í!) ===
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyQBgFVhhNhmhWGeLZB55tbpbxnJW5ah44DlhS_XRFTlBhzIORhJt_1bfen1OW1x51_WA/exec";

    // === –≠–õ–ï–ú–ï–ù–¢–´ ===
    const wheel = document.getElementById('wheel');
    const spinBtn = document.getElementById('spinBtn');
    const resultDiv = document.getElementById('result');
    const employeesList = document.getElementById('employeesList');

    // === –§–£–ù–ö–¶–ò–Ø –ö–†–£–ß–ï–ù–ò–Ø ===
    async function spin() {
      spinBtn.disabled = true;
      spinBtn.textContent = 'üé° –ö—Ä—É—Ç–∏–º...';
      wheel.textContent = '–ö—Ä—É—Ç–∏–º...';
      resultDiv.style.display = 'none';

      // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
      const rotations = 5 + Math.random() * 5;
      const finalDeg = 360 * rotations + Math.random() * 360;
      wheel.style.transform = `rotate(${finalDeg}deg)`;

      // –ó–≤—É–∫ –≤—Ä–∞—â–µ–Ω–∏—è (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏)
      try { spinSound.play(); } catch {}

      let data = null;
      let isDemo = false;

      try {
        // üëá –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ User-Agent, —á—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        const response = await fetch(`${GAS_URL}?action=spin&t=${Date.now()}`, {
          method: 'GET',
          headers: {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
          }
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ HTML –ª–∏ —ç—Ç–æ (¬´Google Êñá‰ª∂„Äç ‚Äî —ç—Ç–æ HTML!)
        const text = await response.text();
        if (text.includes('Google Êñá‰ª∂') || text.includes('<html')) {
          throw new Error('GAS –≤–µ—Ä–Ω—É–ª HTML ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞');
        }

        data = JSON.parse(text);
        if (!data.success) throw new Error(data.error || 'API error');

      } catch (err) {
        console.warn('‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å —É–ø–∞–ª:', err.message);
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º
        data = { success: true, data: DEMO_DATA };
        isDemo = true;
      }

      // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
      await new Promise(r => setTimeout(r, 5000));

      // –ó–≤—É–∫ –ø–æ–±–µ–¥—ã
      try { winSound.play(); } catch {}

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      displayResults(data.data, isDemo);
      spinBtn.disabled = false;
      spinBtn.textContent = 'üéØ –ö—Ä—É—Ç–∏—Ç—å —Å–Ω–æ–≤–∞!';
    }

    function displayResults(employees, isDemo = false) {
      employeesList.innerHTML = '';
      const medals = ['ü•á', 'ü•à', 'ü•â', 'üéñÔ∏è', 'üèÖ'];

      employees.slice(0, 5).forEach((emp, i) => {
        const div = document.createElement('div');
        div.className = 'employee';
        let nameLine = `<span class="medal">${medals[i] || 'üë§'}</span>${emp.name || '‚Äî'}`;
        if (isDemo) nameLine += ` <span class="fallback-badge">–î–ï–ú–û</span>`;
        div.innerHTML = `
          <div class="employee-name">${nameLine}</div>
          üìû –ó–≤–æ–Ω–∫–∏: ${emp.calls || '‚Äì'}<br>
          ‚è± AHT: ${emp.aht || '‚Äì'}<br>
          ‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ: ${emp.missed || '‚Äì'}<br>
          ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ: ${emp.quality || '‚Äì'}
        `;
        employeesList.appendChild(div);
      });

      resultDiv.style.display = 'block';
      wheel.textContent = '–ì–æ—Ç–æ–≤–æ!';
    }

    spinBtn.addEventListener('click', spin);

    // Telegram WebApp
    if (window.Telegram?.WebApp) {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
    }
  </script>
</body>
</html>
